class usuario():
    def __init__(self, id, nombre, apellido, pwd, mail, edad):
        self.id = id
        self.nombre = nombre
        self.apellido = apellido
        self.pwd = pwd
        self.mail = mail
        self.edad = edad
 
class profesor(usuario):
    def __init__(self, id, nombre, apellido, pwd, mail, edad, especialidad):
        super().__init__(id, nombre, apellido, pwd, mail, edad)
        self.especialidad = especialidad
        self.estudiante = []

    def asignarTarea(self, estudiante, tarea):
        estudiante.tareas.append(tarea)

        email = EmailSender(self.mail, self.pwd)
        email.enviar_mail(
            destinatario=estudiante.mail,
            asunto=f"Nueva tarea asignada: {tarea.descripcion}",
            mensaje=f"Hola {estudiante.nombre},"
                   f"Se te ha asignado una nueva tarea:\n"
                   f"Descripción: {tarea.descripcion}\n"
                   f"Consigna: {tarea.consigna}\n"
                   f"Fecha de entrega: {tarea.fechaEntrega}\n"
                   f"Criterio de evaluación: {tarea.criterioEvaluacion}\n"
                   f"Valor: {tarea.valor} monedas\n\n"
                   f"Profesor {self.nombre} {self.apellido}"
        )
        print(f"Tarea asignada y notificación enviada a {estudiante.nombre}")

    def chequearEntrega(self, estudiante, tarea):
        for t in estudiante.tareas:
            if t == tarea:
                print(f"La tarea '{t.descripcion}' ha sido marcada como entregada: {t.entrega}")

    def aprobarTarea(self, estudiante, tarea):
        for t in estudiante.tareas:
            if t == tarea:
                estudiante.coins = tarea.valor
                t.aprobado = True
               
                email = EmailSender(self.mail, self.pwd)
                email.enviar_mail(
                    destinatario=estudiante.mail,
                    asunto=f"¡Tarea aprobada! - {tarea.descripcion}",
                    mensaje=f"¡Felicitaciones {estudiante.nombre}!\n\n"
                           f"Tu tarea '{tarea.descripcion}' ha sido aprobada.\n"
                           f"Has ganado {tarea.valor} monedas.\n"
                           f"Total de monedas: {estudiante.coins}\n\n"
                           f"Profesor {self.nombre} {self.apellido}"
                )
                print(f"El estudiante {estudiante.nombre} posee {estudiante.coins} monedas")
                print(f"Notificación de aprobación enviada a {estudiante.nombre}")

    def visualizarBeneficios(self, estudiante):
        print(f"Beneficios comprados - {estudiante.nombre} {estudiante.apellido}")

       
        if not estudiante.beneficios_canjeados:
            print("Este estudiante no ha canjeado ningún beneficio aún.")
        else:
            for i, beneficio in enumerate(estudiante.beneficios_canjeados, 1):
                print(f"\n{i}. {beneficio['nombre']}")
                print(f"   Costo: {beneficio['costo']} monedas")
                print(f"   Fecha de canje: {beneficio['fecha']}")
        print(f"Total de beneficios canjeados: {len(estudiante.beneficios_canjeados)}")
        print(f"Monedas actuales del estudiante: {estudiante.coins}")

class estudiante(usuario):
    def __init__(self, id, nombre, apellido, pwd, mail, edad, curso, legajo, coins=0):
        super().__init__(id, nombre, apellido, pwd, mail, edad)
        self.curso = curso
        self.legajo = legajo
        self.coins = coins
        self.tareas = []
        self.beneficios_canjeados = []

    def entregarTarea(self, tarea):
        for t in self.tareas:
            if t == tarea:
                t.entrega = True
                print(f"Tarea '{t.descripcion}' entregada exitosamente")

    def checkearTareas(self):

        print(f"Tareas de {self.nombre} {self.apellido}")

       
        if not self.tareas:
            print("No tienes tareas asignadas.")
        else:
            for i, tarea in enumerate(self.tareas, 1):
                print(f"\n{i}. {tarea.descripcion}")
                print(f"   Consigna: {tarea.consigna}")
                print(f"   Fecha de entrega: {tarea.fechaEntrega}")
                print(f"   Valor: {tarea.valor} monedas")
               

                if tarea.entrega:
                    print(f"   Estado entrega: ENTREGADA")
                else:
                    print(f"   Estado entrega: PENDIENTE")
               

                if tarea.aprobado:
                    print(f"   Estado aprobación: APROBADA")
                else:
                    print(f"   Estado aprobación: SIN APROBAR")

        print(f"Total de tareas: {len(self.tareas)}")
        tareas_entregadas = sum(1 for t in self.tareas if t.entrega)
        tareas_aprobadas = sum(1 for t in self.tareas if t.aprobado)
        print(f"Tareas entregadas: {tareas_entregadas}/{len(self.tareas)}")
        print(f"Tareas aprobadas: {tareas_aprobadas}/{len(self.tareas)}")
        print(f"Monedas totales: {self.coins}")

    def canjearBeneficio(self, beneficio, profesor):
         
        if self.coins >= beneficio.costo:
            self.coins -= beneficio.costo
            self.beneficios_canjeados.append({
                'nombre': beneficio.nombre,
                'costo': beneficio.costo})
            email = EmailSender(profesor.mail, profesor.pwd)
            email.enviar_mail(
                destinatario=profesor.mail,
                asunto=f"Beneficio canjeado por {self.nombre} {self.apellido}",
                mensaje=f"Hola Profesor {profesor.nombre},\n\n"
                       f"El estudiante {self.nombre} {self.apellido} ha canjeado el siguiente beneficio:\n\n"
                       f"Beneficio: {beneficio.nombre}\n"
                       f"Costo: {beneficio.costo} monedas\n"
                       f"Monedas restantes del estudiante: {self.coins}\n\n"
                       f"Sistema de Gestión Académica"
            )
           
            print(f"Beneficio '{beneficio.nombre}' canjeado exitosamente!")
            print(f"Monedas restantes: {self.coins}")
            print(f"Notificación enviada al profesor {profesor.nombre}")
           
            return True
        else:
            print(f"No tienes suficientes monedas para canjear este beneficio.")
            print(f"Necesitas: {beneficio.costo} monedas")
            print(f"Tienes: {self.coins} monedas")
            print(f"Te faltan: {beneficio.costo - self.coins} monedas")
            return False
   
    def verBeneficiosDisponibles(self, lista_beneficios):
        print(f"Beneficios disponibles")
        print(f"Tus monedas actuales: {self.coins}")

        for i, beneficio in enumerate(lista_beneficios, 1):
            disponible = "si" if self.coins >= beneficio.costo else "no"
            print(f"\n{i}. {beneficio.nombre} - {beneficio.costo} monedas {disponible}")    
